# PillSnap INIT — 아키텍처/계획 온보딩 (2025-09-03 v2)

## 1. 문서 인덱스 요약 (최신 5개)

| 파일명 | 경로 | 수정일 | 키워드 |
|--------|------|--------|---------|
| CLAUDE_MEMORY.md | `docs/` | 2025-09-03 11:01 | 절대수칙, 즉시실행, withOpacity금지 |
| ARCHITECTURE.md | `docs/` | 2025-09-03 09:56 | 폴더구조, 레이어, 라우팅, 상태관리 |
| PROGRESS_2025-09-03.md | `docs/` | 2025-09-03 09:54 | Phase 0-4 완료, 40% 진행 |
| flutter_architecture_guide | `docs/` | 2025-09-03 08:01 | Clean Architecture, 구현패턴 |
| pillsnap_migration_plan | `docs/` | 2025-09-03 00:55 | 10단계 Phase, 체크리스트 |

## 2. 아키텍처 규칙 (정규화 본문)

### 📁 폴더 구조 표준

**Feature-first + Layered Architecture** 철저 준수

```
lib/
├── core/                       # 앱 전역 공통
│   ├── error/                 # exceptions.dart, failures.dart
│   ├── network/               # api_client.dart, api_endpoints.dart
│   ├── router/                # go_router 필수
│   │   ├── app_router.dart   
│   │   └── route_paths.dart  # 경로 상수만
│   ├── widgets/               # 공통 UI 컴포넌트
│   └── utils/                 # validators, formatters
├── theme/                     # 디자인 토큰 (하드코딩 금지)
│   ├── app_theme.dart        
│   ├── app_colors.dart       
│   ├── app_typography.dart   
│   ├── app_spacing.dart      
│   └── app_dimensions.dart   
├── features/                  # 기능별 모듈
│   └── [feature_name]/
│       ├── data/
│       │   ├── datasources/  
│       │   ├── models/       # freezed + json_serializable
│       │   └── repositories/ 
│       ├── domain/
│       │   ├── entities/     # freezed 불변객체
│       │   ├── repositories/ # 추상 인터페이스
│       │   └── usecases/     # Either<Failure, T>
│       └── presentation/
│           ├── controllers/  # AsyncNotifier/Notifier만
│           ├── pages/        
│           └── widgets/      
├── l10n/                     # ARB 파일 (문장 2줄 제한)
│   ├── app_ko.arb           
│   └── app_en.arb           
└── main.dart                
```

### 🚦 라우팅 규칙

- **필수**: go_router 사용
- **필수**: route_paths.dart 상수만 참조
- **필수**: ShellRoute로 하단 네비게이션
- **금지**: Navigator.pushNamed
- **금지**: 하드코딩된 경로

### 🎯 상태관리 규칙

- **필수**: AsyncNotifier, Notifier, FutureProvider, StreamProvider
- **필수**: @riverpod 어노테이션 + build_runner
- **금지**: StateProvider, StateNotifierProvider
- **금지**: 위젯 내 Provider 생성
- **금지**: build 외부에서 ref.watch()

### 🏛️ 도메인 규칙

1. **Entity**: freezed 불변 객체
2. **Repository**: 추상 인터페이스 (domain 레이어)
3. **UseCase**: Either<Failure, T> 반환
4. **Model↔Entity**: toEntity(), fromEntity() 필수

### 🎨 테마/토큰 시스템

**하드코딩 절대 금지**
- 색상: AppColors.primary
- 타이포: AppTextStyles.headline1
- 간격: AppSpacing.md
- 반경: AppDimensions.radiusMedium
- **withOpacity 금지**: withValues(alpha: value) 사용

### 🌍 국제화(i18n) 규칙

- **필수**: 모든 텍스트 ARB 경유
- **필수**: 문장 2줄 제한
- **규칙**: 키네이밍 `feature_component_description`
- **변수**: `{variable}` 형식

### 🧪 테스트/품질 구조

```
test/
├── unit/            # UseCase, Repository
├── widget/          # 화면, 위젯
└── integration/     # 통합, E2E
```

**필수 검증**:
- flutter analyze 에러 0개
- flutter format 적용
- 테스트 커버리지 80% 목표

## 3. 충돌·중복·누락 리포트

| 이슈 | 근거 | 권고안 | 리스크 |
|------|------|---------|--------|
| **Phase 진행 불일치** | PROGRESS: Phase 5 대기 / 이전 INIT: Phase 5 진행중 표기 | PROGRESS 기준 Phase 5 새로 시작 | 낮음 |
| **StateProvider 사용** | ARCHITECTURE 문서 예시코드에 StateProvider 잔존 | 전체 AsyncNotifier 교체 | 중간 |
| **ARB 파일 미생성** | l10n 폴더 없음 | 즉시 생성 필요 | 중간 |
| **withOpacity 잔존** | 일부 파일에 deprecated API | 전체 검색 후 교체 | 낮음 |
| **route_paths.dart 미생성** | core/router 폴더 구조 미완성 | 상수 파일 생성 | 높음 |

## 4. 실행 체크리스트

### 🚀 즉시 실행 (30분 이내)

| # | 작업 | 난이도 | 소요 | 블로커 |
|---|------|--------|------|--------|
| 1 | ARB 파일 생성 `mkdir -p lib/l10n && touch lib/l10n/app_{ko,en}.arb` | S | 2분 | - |
| 2 | l10n 설정 `flutter gen-l10n` | S | 3분 | ARB파일 |
| 3 | withOpacity 검색/교체 `grep -r "withOpacity" lib/` | S | 10분 | - |
| 4 | route_paths.dart 생성 | S | 5분 | - |
| 5 | StateProvider → AsyncNotifier 마이그레이션 | M | 15분 | - |

### 📱 Phase 5: Drug Detail (1시간)

| # | 작업 | 난이도 | 소요 | 블로커 |
|---|------|--------|------|--------|
| 1 | features/drug 폴더 구조 생성 | S | 3분 | - |
| 2 | Drug Entity 생성 (freezed) | S | 10분 | - |
| 3 | DrugRepository 인터페이스 | S | 10분 | - |
| 4 | GetDrugDetail UseCase | M | 15분 | - |
| 5 | DrugDetailPage UI 구현 | M | 20분 | assets |

### 🔧 Phase 6-10 우선순위

| Phase | 내용 | 난이도 | 소요 | 블로커 |
|-------|------|--------|------|--------|
| 7 | 공통 컴포넌트 추출 | M | 1시간 | theme 토큰 |
| 9 | i18n 전체 적용 | M | 1시간 | ARB 파일 |
| 8 | 라우팅 통합 | M | 1시간 | 모든 화면 |
| 6 | Settings | S | 30분 | - |
| 10 | 최종 검증 | L | 1시간 | 전체 완료 |

## 5. Phase 맵핑

### 현재 상태와 Gap 분석

| Phase | 계획 | 완료율 | Gap | 다음 액션 |
|-------|------|--------|-----|-----------|
| 0 | 기본 설정 | 100% | - | ✅ 완료 |
| 1 | Auth 4개 화면 | 100% | - | ✅ 완료 |
| 2 | Onboarding | 100% | - | ✅ 완료 |
| 3 | Home + Nav | 100% | - | ✅ 완료 |
| 4 | Camera | 100% | - | ✅ 완료 |
| 5 | Drug Detail | 0% | 전체 미구현 | **즉시 시작** |
| 6 | Settings | 0% | 전체 미구현 | Phase 5 후 |
| 7 | 공통 컴포넌트 | 0% | 추출 필요 | 병행 가능 |
| 8 | 라우팅 통합 | 70% | 일부 미연결 | Phase 6 후 |
| 9 | i18n | 0% | ARB 미생성 | **즉시 시작** |
| 10 | 최종 검증 | 0% | - | 모든 Phase 후 |

**전체 진행률: 40%**

## 6. 리스크/의존성

### 기술적 리스크

| 항목 | 수준 | 영향 | 완화 방안 |
|------|------|------|-----------|
| API 미정의 | 높음 | Drug/Settings 차단 | Mock 데이터 사용 |
| 카메라 권한 | 중간 | iOS 심사 | Info.plist 상세 설명 |
| 이미지 성능 | 중간 | 메모리 | 캐싱/압축 전략 |

### 프로세스 리스크

| 항목 | 수준 | 영향 | 완화 방안 |
|------|------|------|-----------|
| 코드 리뷰 부재 | 중간 | 품질 | 체크리스트 활용 |
| 테스트 부족 | 중간 | 버그 | 핵심 로직 우선 |

## 7. 검토 요청

### 🎯 의사결정 필요사항

#### A. i18n 적용 시점

| 옵션 | 선택 | 이유 |
|------|------|------|
| **즉시 전체 적용** | ✅ | 재작업 방지, 일관성 |
| Phase 9 일괄 | - | - |

#### B. 컴포넌트 추출

| 옵션 | 선택 | 이유 |
|------|------|------|
| Phase 7 집중 | - | - |
| **발견 즉시** | ✅ | 중복 최소화 |

### ✅ 우선 실행 Top 5

1. **ARB 파일 생성 및 l10n 설정** (5분)
2. **withOpacity → withValues 교체** (10분)
3. **route_paths.dart 생성** (5분)
4. **StateProvider → AsyncNotifier** (15분)
5. **Phase 5 Drug Detail 시작** (1시간)

### 📊 품질 체크리스트

| 항목 | 현재 | 목표 | 검증 방법 |
|------|------|------|-----------|
| 코드 품질 | ✅ | 0 에러 | `flutter analyze` |
| 포맷팅 | ⚠️ | 100% | `flutter format .` |
| 테스트 커버리지 | 10% | 80% | `flutter test --coverage` |
| 문장 길이 | - | 2줄 이내 | ARB 검토 |
| withOpacity | ⚠️ | 0개 | `grep -r withOpacity` |
| 접근성 | 30% | 80% | Flutter Inspector |

---

## 📌 최종 승인 요청

위 분석을 바탕으로:

1. **즉시 실행 작업** 5개 항목 (30분)
2. **Phase 5 Drug Detail** 구현 (1시간)
3. **i18n 기반** 즉시 구축
4. **공통 컴포넌트** 발견 즉시 추출

**승인 시 즉시 실행하겠습니다.**

*문서 생성: 2025-09-03 v2 / PillSnap INIT System*